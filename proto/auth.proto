syntax = "proto3";

option go_package = "github.com/jairoprogramador/fd-plugin-auth-azure/internal/fdplugin";

package fdplugin;

enum AuthGrantType {
  AUTH_GRANT_TYPE_UNSPECIFIED = 0;
  AUTH_GRANT_TYPE_INTERACTIVE_BROWSER = 1;
  AUTH_GRANT_TYPE_CLIENT_CREDENTIALS = 2;
  AUTH_GRANT_TYPE_DEVICE_CODE = 3;
}

message AuthConfig {
  string client_id = 1;
  string client_secret = 2;
  string scope = 3;
  AuthGrantType grant_type = 4;
  map<string, string> extra = 5;
}

message AuthToken {
  string access_token = 1;
  string refresh_token = 2;
  string token_type = 3;
  int64 expires_at_unix = 4;
  map<string, string> metadata = 5;
}

message AuthenticateRequest {
  AuthConfig config = 1;
}

message AuthenticateResponse {
  AuthToken token = 1;
}

message ValidateRequest {
  AuthToken token = 1;
}

message ValidateResponse {
  bool valid = 1;
  string reason = 2;
}

message RefreshRequest {
  AuthToken token = 1;
  AuthConfig config = 2;
}

message RefreshResponse {
  AuthToken new_token = 1;
}

service AuthService {
  rpc Authenticate(AuthenticateRequest) returns (AuthenticateResponse);
  rpc Validate(ValidateRequest) returns (ValidateResponse);
  rpc Refresh(RefreshRequest) returns (RefreshResponse);
}
